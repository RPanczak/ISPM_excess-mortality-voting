---
title: "Local correlates of municipality-level excess mortality in Switzerland in 2020"
author: "Julien Riou, Radoslaw Panczak, Garyfallos Konstantinoudis, Matthias Egger"
date: "`r Sys.Date()`"
output: word_document
bibliography: bib.bib  
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../docs") })
---


```{r setup, include = FALSE}
pacman::p_load(tidyverse, 
               scales,
               hrbrthemes, 
               sf, 
               INLA)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
theme_set(theme_bw())
```

```{r , echo=FALSE}
kt = read_rds("data/BfS/kt.Rds")
tg3o = read_rds("data/BfS/tg3o.Rds")
shap = list(kt=kt,tg3o=tg3o)
```
Target: short report EJPH, max 1200 words, abstract 100 word, 10 refs, 1 figure (https://academic.oup.com/eurpub/pages/Instructions_For_Authors#Format%20of%20contributions)

# Abstract

# Introduction

Excess all-cause mortality has become central to assessing the impact of the COVID-19 pandemic and other unusual events such as heat waves on mortality. 
In most cases, the estimation of excess mortality relies upon predicting the expected number of deaths in a given population from historical data. 
Multiple approaches have been proposed, with varying levels of complexity, length of training data, assumptions regarding population sizes, and groups of stratification. 
The levels of spatial and temporal granularity have also varied from the country down to the municipal level[@brandily2021poorly][@blangiardo2020estimating][@acosta2022all][antonio2022comprehensive], depending on data availability and research questions.
Several ecological studies have aimed to explore associations the temporal variability in excess mortality to various local characteristics[@brandily2021poorly][@bertoli2020turnout]. 
In this study, we aimed to estimate excess mortality at the municipal level in Switzerland in 2020, describe spatial patterns, and explore associations with local covariates such as rural/urban classification, international borders, socio-economic position and results from two referendums on COVID-19 control measures held in 2020.  
We aimed to create a high-resolution map of the remaining municipality-specific effects on excess mortality in 2020 adjusted for these factors, and shed a new light on the first year of the pandemic.

# Methods

Data on all-cause deaths at the municipal level in Switzerland for 2020 were obtained from the Swiss National Cohort. 
Data on total population and all-cause deaths at the cantonal level for the years 2011–2020 were obtained from the Federal Statistical Office (FSO).
These data were aggregated by week, canton (26 levels), age group (40–59, 60–69, 70–79 and 80 and older, ages below 40 were ignored because of low deaths counts [@konstantinoudis2022regional]) and sex 
Data on ambient temperature were obtained from the ECMWF Reanalysis version 5 (ERA5). 

We obtained the yearly excess mortality in 2020 at the municipal level in three steps, including computation at a higher geographic level (the canton), aggregation from week to year, and downscaling from canton to municipality. 
In a first step, we computed estimates of expected mortality for each week of 2020 at the cantonal level using a previously validated approach [@riou2023direct]. 
Briefly, we predicted the expected number of deaths for each week of 2020 by canton, age group and sex using a Bayesian spatio-temporal model fitted to data from the period 2011-2019. 
This model accounted for long-term and seasonal trends in mortality, for ambient temperature, for public holidays and for changes in population size.
In a second step, we aggregated the results from week to year. 
In a third step, we downscaled the expected number of deaths from the cantonal to the nested municipal level (2,141 levels) by randomly sampling from a multinomial distribution with weights calculated using the observed distribution of deaths. 
As for the other steps, this third step was repeated multiple times to ensure the propagation of all sources of uncertainty. 
We then computed the yearly excess mortality by age, sex and municipality by substracting the expected from the observed number of deaths. 
This approach based on cantonal estimates and downscaling was chosen because of the large computational cost of modelling population and expected deaths at the municipal level.

We then explored the local correlates of excess mortality at the municipal level using a model structure similar to Poisson regression, where $O_{t,i,j,k}$, the number of observed deaths during week $t$ in municipality $i$, age group $j$ and sex group $k$, depends on the number of expected deaths $E_{t,i,j,k}$ based on historical data multiplied by a log-linear predictor $\lambda = \exp(\alpha + X\beta)$ (with intercept $\alpha$, design matrix $X$ and parameter vector $\beta$).
<!-- $$ -->
<!-- O_i \sim \text{Poisson}(\lambda E_i). -->
<!-- $$ -->
During model development, we followed an iterative approach by progressively adding complexity to $\lambda$. 
A full description is available in supplementary text S1. 
The models included separate intercepts by age group and sex, spatial autocorrelation across municipalities based on an extension of the Besag–York–Mollié model [@riebler2016intuitive], and covariates related to each municipality: classification as rural, peri-urban or urban (as defined by the FSO); median socio-economic position (in five quintiles, based on the Swiss neighbourhood index of socio-economic position [SEP] [@panczak2023swiss]); existence of a border with another country, official language (in 3 classes: German, Italian or French) and results from the two national referendums on COVID-19 control measures held in June and November 2020 (in 5 quintiles). 
We considered interactions between covariates and age/sex groups, but the spatial effect applied in the same way to all groups. 
All the models were implemented in R-INLA, a Bayesian inference package that is especially adapted to spatial data [@rue2009approximate]. 
We first focused on the median excess mortality (MEM) by municipality, ignoring the uncertainty. 
To ensure a full propagation of the uncertainty, the final results were averaged over 50 posterior samples of municipality-level excess mortality.

# Results

```{r, echo=FALSE}
source("R/helper_functions.R")
load("results_inla/local_corr_models.Rdata")
model1.5_merg = readRDS("results_inla/model1.5_merg.rds")
```

We observed a total of 74,776 all-cause deaths in people aged 40 and older in Switzerland in 2020, compared to an expected 55,676 (95% credible interval: 53,865 to 57,821). 
This corresponds to a relative increase in excess mortality of 34% (29 to 39%) over the year. 
Relative excess mortality varied across age groups and sex, with as expected higher estimates in older age groups and males (Supplementary text S1).
There were large variations across geographical areas (Figure 1A), with 99% (89 to 100%) of the variability explained by spatial autocorrelation across neighboring municipalities. 
Areas most affected by excess mortality in 2020 included Ticino (south-central), the Lake Geneva region (south-west) and the Jura (north-west). 
Large cities of the German-speaking area (Zurich, Basel and Bern) were comparatively less affected (see interactive map in Supplementary text S1).
Mountainous areas of Graubunden (south-east) were also less affected than Valais and Ticino (south-central). 
There were a few outliers corresponding to sparsely-populated municipalities in the north-central area (more affected than their surroundings) and in the south-central and south-west areas (less affected than their surroundings), highlighting the stochastic nature of epidemic spread in low density areas.

We explored whether the spatial variability in the median excess mortality (MEM) was associated with local characteristics. 
In the univariable analysis (Supplementary text S1), contrary to expectations urban municipalities appeared to have -2 to -13% MEM in age groups over 60 compared to municipalities classified as rural. 
Municipalities sharing a border with another country had between -2 and +16% MEM (depending on the age groups). 
Municipalities of lowest median SEP (1st quintile) had +1 to +29% MEM mortality in 2020 compared to municipalities of highest median SEP (5th quintile). 
We generally observed a gradient in the association between SEP quintiles and MEM in all age groups, although less marked in people aged 80 and older. 
Although high uncertainty remains, municipalities expressing the lowest support to control measures in the June and November referendums (1st quantile) had +1 to +8% MEM in age group 80+ compared to municipalities with highest support (5th quintile), also with a gradient in this age group. 
The association with language regions was more ambiguous. 
We estimated -2 to +18% MEM in French-speaking and +7 to +42% MEM in Italian-speaking compared to German-speaking municipalities across all age groups, but this association is likely confounded by the initial international spread of SARS-CoV-2 in 2020 (that started in Italian-speaking Ticino and the French-speaking south-west). 
<!-- Indeed, looking at the municipality-specific effects shows that French-speaking areas that were less affected initially (such as Neuchâtel and Jura, west) have a negative residual effect to compensate.  -->
The association with language is thus better assessed through the spatial variability rather than a fixed effect of language at the municipality level. 
The neat separation between the French-speaking and German-speaking municipalities around canton Fribourg suggested low levels of interconnection across these populations (Supplementary text S1).

The multivariable model including rural/urban status, border, median SEP and results from the first COVID-19 referendum confirmed the association with SEP quintiles in age groups below 80, with a clear gradient, and the association with rural/urban status and international borders. 
The association between MEM and results from the June COVID-19 referendum strongly decreased, likely because of collinearity with SEP (Supplementary text S1). 
When the multivariable model was applied to a set of posterior samples of excess mortality by municipality rather than the MEM, allowing for a full propagation of uncertainty, the results became more undecided, with all estimates compatible with no association (Figure 1B). 
Still, there remained a gradient in the association between SEP quintiles and excess mortality in age groups below 80, although with high uncertainty.
Similarly, most spatial patterns persisted with higher uncertainty. 
In addition to the already-mentioned patterns, the map of municipality-specific effects adjusted for the covariates brought out an area of comparatively higher excess mortality in the north-east, that could not be observed on the unadjusted map. 

```{r, echo=FALSE, fig.height=12.5,fig.width=9.5,fig.cap="(A) Municipality-specific relative excess mortality in 2020. (B) Local correlates of excess mortality at the municipality level in 2020. (B) Municipality-specific relative excess mortality in 2020 adjusted for aforementioned covariates."}
g0 = map_munic_final(model1.3,data1,shap)
g1 = map_munic_final(model1.5_merg,data1,shap,fillname="Adjusted relative\nexcess mortality")
g2 = drivers_plot_age_final(model1.5_merg,data1,compute_cri = TRUE)
cowplot::plot_grid(g0,g2,g1,labels=c("A","B","C"), nrow=3, rel_heights = c(1,.8,1))
```

# Discussion

In this work, we created a high-resolution mapping of the excess mortality in Switzerland in 2020, mostly attributable to COVID-19, for the first time at the municipality level.
We also proposed an approach to adjust for local characteristics, allowing to explore associations and to observe spatial patterns after accounting for known drivers of COVID-19 mortality.
We confirmed known facts about highly-affected areas in the south and south-west, and brought new insights about areas in the north-west and north-east that were comparatively more affected than their surroundings. 
We also report lower impacts in large cities away from the initial epidemic centers such as Basel, that persisted after adjustment for SEP and support to control measures (that could considered to be a proxy for adherence to control measures). 
These could be explained by other aspects such as lower household sizes or behavioral differences.
We also highlight the lower impacts of COVID-19 in some mountainous areas.
Besides providing improved estimates and a more detailed picture of the course of the pandemic in Switzerland in 2020, this work brings valuable lessons regarding potential pitfalls in ecological analyses of excess mortality.
The first lesson is that in this type of studies, where the dependent variable is itself model-predicted, it is absolutely crucial to propagate all sources of uncertainty in the final results.
Failing to do so, as we did when we focused on median excess mortality by municipality, led to severely underestimating the uncertainty around the estimates.
Indeed, while the gradient of association between SEP and excess and thus COVID-19 mortality has been shown in several other studies [@brandily2021poorly][@riou2021socioeconomic], this study does not bring clear evidence in favor of this association. 
Second, as for many other approaches, the results rely upon appropriate adjustment on relevant covariates.
A typical example of this is given by the positive association between median excess mortality and a lack of support of control measures as expressed by the results of the referendums found in the univariable analysis, which appears to be confounded by the SEP, likely because of collinearity.
Of course, collinearity implies that both SEP and voting results are measuring a similar phenomenon, and we are far removed from any attempt at causal inference, so this could be considered as unimpactful.
The third lesson is that it is central to consider the underlying mechanisms leading to the excess mortality. 
Assuming that most of the excess mortality in 2020 can be attributed to COVID-19, the initial international spread of the disease from China to Europe played a key role in determining which areas ended up being the most affected.
The early epidemic in northern Italy and then France led to early introductions in south and south-west Switzerland, and this head start led to higher excess mortality in these areas, that happened to be in majority Italian- and French-speaking.
Careless interpretations could (and did) attribute this higher toll to cultural differences, while it is the stochastic spread of the underlying cause of the excess (COVID-19) that is ultimately responsible.
Still, the neat separation observed between French- and German-speaking areas could be partially attributed to language, not through differential susceptibility to infection but rather through low interconnection between these populations.


# Acknowledgements

JR is supported by the Swiss Federal Office of Public Health (142005806) and by the Swiss National Science Foundation (189498). G.K. is supported by an MRC Skills Development Fellowship [MR/T025352/1] and an Imperial College Research Fellowship. 

# References